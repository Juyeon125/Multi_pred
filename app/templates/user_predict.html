{% extends "base.html" %}
{% block title %}My Predicted List{% endblock %}
{% block mainTitle %}My Predicted List{% endblock %}
{% block head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/datatables/dataTables.bootstrap4.css') }}">
{% endblock %}
{% block breadcrumb %}
    <li class="breadcrumb-item"><a href="/">Home</a></li>
    <li class="breadcrumb-item active" aria-current="page"><a href="/user_predict">My Predicted List</a></li>
{% endblock %}
{% block mainContent %}
    <section id="user_predict" class="card my-3">
        <div class="card-body">
            <div class="mb-1 text-h2">Predicted List</div>
            <ul class="list mt-3">
                <li id="job" class="ph-item">
                    <div class="ph-header" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_result"
                         aria-expanded="true" aria-controls="collapse_result">
                        Not found predicted list
                    </div>
                    <div class="ph-body p-3 collapse" id="none">
                    </div>
                </li>
            </ul>
        </div>
    </section>
{% endblock %}
{% block mainScript %}
    <script>
        $.ajax({
            url: "/user_predict.do",
            method: "GET",
            dataType: "json",
            success: function (res) {
                console.log(res);
                draw_predicted_list(res)
            },
            error: function (err) {
                console.log(err);
            }
        })

        function draw_predicted_list(res) {
            const list_root = $("#job");
            const list_head = list_root.find(".ph-header");
            const list_body = list_root.find(".ph-body");
            const id_list = res['job_id_list']
            const job_data = res['job_data']

            if (id_list !== null) {
                list_head.empty();
                {#list_body.attr('id', 'collapse_result');#}
                create_query_result(res, list_root, false)
            }
        }

        function create_query_result(query_result, list_root, append_hr) {
            //id list = 예측 기록 갯수
            //job_data = 한번 예측 할때의 시퀀스 갯수
            const list_head = $('<div class="ph-header" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_result" aria-expanded="true" aria-controls="collapse_result"></div')
            const list_body = $('<div class="ph-body p-3 collapse" id="none">')
            const id_list = query_result['job_id_list']
            const job_data = query_result['job_data']
            const dom_row = $('<div class="row"></div>');

            for (i = 0; i < id_list.length; i++) {
                list_root.append(list_head)
                list_head.append($('<p>Jod ID > ' + id_list[i] + '</p>'));
                for (j = 0; j < job_data[query_result['job_id_list'][i]].length; j++) {
                    list_root.append(dom_row)
                    dom_row.append($('<div class="col-md-6 markdown"><h3>Query ID</h3><p>' + job_data[query_result['job_id_list'][i]][j]['query_id'] + '</p></div>'));
                    dom_row.append($('<div class="col-md-6 markdown"><h3>Date</h3><p>' + job_data[query_result['job_id_list'][i]][j]['modified_datetime'] + '</p></div>'));
                    list_body.append(dom_row)
                }
            }

        }
    </script>
{% endblock %}
